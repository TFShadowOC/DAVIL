<!DOCTYPE html>
<html lang="en">
<head>
    <title>BeatHeart</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

    <div class="heart"></div>
      <audio id="music" src="BMTH-FY.mp3"></audio>


</body>
    <script>
   const heart = document.querySelector('.heart');
    const audio = document.getElementById('music');

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const analyser = audioCtx.createAnalyser();
    analyser.fftSize = 256;

    const source = audioCtx.createMediaElementSource(audio);
    source.connect(analyser);
    analyser.connect(audioCtx.destination);

    const dataArray = new Uint8Array(analyser.frequencyBinCount);

    let lastBeat = 0;
    const cooldown = 200; //ms
    const beatThreshold = 140;

    function animateHeart() {
      analyser.getByteFrequencyData(dataArray);
      const avg = dataArray.reduce((a, b) => a + b) / dataArray.length;

      const now = Date.now();
      if (avg > beatThreshold && now - lastBeat > cooldown) {
        heart.classList.add('beat-once');
        setTimeout(() => heart.classList.remove('beat-once'), 100);
        lastBeat = now;
      }

      requestAnimationFrame(animateHeart);
    }

    heart.addEventListener('click', () => {
      heart.classList.add('beat-once');
      setTimeout(() => heart.classList.remove('beat-once'), 600);

      if (audio.paused) {
        audioCtx.resume();
        audio.play();
        animateHeart();
      } else {
        audio.pause();
      }
    });
  </script>  
</html>
